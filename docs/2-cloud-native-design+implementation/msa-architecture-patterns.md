---
id: MSA Architecture Patterns
sidebar_position: 1
sidebar_label: MSA Architecture Patterns
---

A number of patterns and best practices have been defined for microservice architectures; however Chris Richardson
provides a great overview and illustration of these at his website https://microservices.io/, which we will delve into below:

![Micoservice Pattern Language ](microservicepatternlanguage.jpg)

With definitions being:

##### Application Patterns

| **Pattern**            | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Notes                                                                                                                                                                                    |
|:-----------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| _Decomposition_        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Completed as per our DDD                                                                                                                                                                 |
| Decompose by subdomain | As per our previous sections, we may use Domain Driven Design to formulate appropriate decomposition of services to business capabilities or _subdomains_. We will focus on the Order, Fulfillment and Reporting domains for the above example.                                                                                                                                                                                                                                                                                         | We will use AWS Cloudformation to define a 'stack' for each service and its dependencies, to be described in the next section                                                            |
| Self-contained Service | Services own and define all of their dependencies such as data storage, security resources etc; such that they can be deployed quickly and independently across environments. This includes for example having their own security roles, firewall definitions, databases (see below), SSL certificates and domain records defined; external/shared dependencies are kept to a minimum; such as the VPC in which they reside.                                                                                                            | N/A                                                                                                                                                                                      |
| _Data Patterns_        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                          |
| Database per Service   | Implementing a database specific to a service helps promote system agility via cohesion and decoupling of services, and minimising their external dependencies. This is in-contrast to implementing a 'shared database', which while may provide a simpler system design including for transaction management and defining wider data relationships, change agility becomes reduced while database changes may impact all connected services.                                                                                           | Each service may implement its own datastore, using the most appropriate technology (e.g. Sql or NoSQL)                                                                                  |
| API Composition        | While microservices serve a specific subdomain for sending, receiving and processing of data, it is very common that clients may wish to query data that span multiple related services; e.g. both Order and Product services to provide inventory details of an order. API's may by created to serve a client, by implementing endpoints (e.g. 'GET /orderdetails' that can span multiple services and aggregate the results to return to the client. This greatly reduces the complexity and domain knowledge required by the client. | AWS API Gateway will be used as a proxy for HTTPS services, which may provide security (authentication and authorisation), throttling, caching and request/response translation services |
| CQRS                   | To promote scalability and resilience of a service's communications with a database, the Command and Query Responsibility Segregation is promoted, whereby writing of data to a database is performed separately and asynchronously (using 'eventual consistency') from synchronous read operations to the database. This will be described in further depth later.                                                                                                                                                                     |                                                                                                                                                                                          |
| Saga                   | Methodology that allows a distributed data transaction spanning multiple databases (or other data stores) to be rolled-back via compensatory actions. Note this becomes a necessary complexity for microservice architectures when a shared database is not used, in favour of agility.                                                                                                                                                                                                                                                 |                                                                                                                                                                                          |


##### Application Infrastructure Patterns

| **Pattern**                                     | Description                                                                                                                                                                                                                                                                                                                            | Notes                                                                                                |
|:------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------|
| _Cross-cutting concerns_                        |                                                                                                                                                                                                                                                                                                                                        |                                                                                                      |
| Externalized configuration                      |                                                                                                                                                                                                                                                                                                                                        | To be implemented using AWS SSM ParameterStore, AWS SecretsManager                                   |
| _Communication Style_                           |                                                                                                                                                                                                                                                                                                                                        |                                                                                                      |
| Messaging (asynchronous)                        | A message channel is used by a service for sending messages to a destination, where an immediate response is not required. This pattern provides system resilience, by catering for cases where a destination system may be slow to response or temporarily unavailable. Examples include Email, and messages queues.                  | AWS SNS, AWS SQS, AWS EventBridge                                                                    |
| Remote Procedure Invocation (RPC) (synchronous) | Describes calls from a service to a destination where an immediate response is expected. Examples include HTTP(S) invocations.                                                                                                                                                                                                         | AWS SDK                                                                                              |
 | Idempotent Consumer                            | Describes how services should be able to handle receiving duplicate requests without causing side-effect to the system. This is particulary-important to cater for "At-Least-Once Delivery" of some message transport resources such as SQS to target services, and in cases where requests may need to be replayed for error handling |  
| _Reliability_                                   |                                                                                                                                                                                                                                                                                                                                        |                                                                                                      |
| Circuit Breaker                                 | A service proxy that stops sending requests to a service when an error threshold is reached; to help prevent a single service failure from impacting the remainder of the system                                                                                                                                                       |                                                                                                      |
| _Observability_                                 |                                                                                                                                                                                                                                                                                                                                        |                                                                                                      |
| Logging                                         |                                                                                                                                                                                                                                                                                                                                        | AWS Cloudwatch                                                                                       |
| Metrics                                         |                                                                                                                                                                                                                                                                                                                                        | AWS Cloudwatch                                                                                       |
| Distributed tracing                             |                                                                                                                                                                                                                                                                                                                                        | AWS x-ray                                                                                            |
| Health check API                                |                                                                                                                                                                                                                                                                                                                                        | AWS Cloudwatch alarms, healthcheck endpoint support e.g. Route53, Load Balancers, Autoscaling groups |


##### Infrastructure Patterns

| **Pattern**           | Description                                                                                                                                                                                                                                                                                                                                                                                           | Notes                                                                                                                                                    |
|:----------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|
| Service per VM        | Each service/microservice is deployed to its own virtual machine (AWS EC2 instances). Horizontal scaling of the service may be realized by spawning new instances of VM's containing the application. Note scaliing can be slow, as initializing a VM requires bootstrapping of its underlying OS and infrastructure services.                                                                        |                                                                                                                                                   |
| Serverless deployment | The hosts and OS of services/microservices are abstracted away from the implementer, and the cloud provider assumes responsibility for managing these. Typically the cloud customer simply specifies the CPU and storage units tha are required, and costs ar ebased on these and time. AWS technologies include Lambda (Function as a Service), AWS ECS (Fargate), AWS EKS (Fargate)                 | As request processing is expected to be short in duration, it is anticpated that Lambda may be predominantly used, for simplicity and optimal scalability |
| Service per container | Each service/microservice is deployed to its own docker container.  Horizontal scaling of the service may be realized by spawning new containers containing the application on a machine. In contrast to VM-based scaling, container scaling is typically fast. AWS services include: AWS ECS, AWS EKS                                                                                                |                                                                                                                                      |

